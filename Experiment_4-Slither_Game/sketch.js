/*
----- The Slither Game ----- 
Adapted from: Patt Vira (2023)
Tutorial: p5.js Coding Tutorial | Snake Game
Source: https://youtu.be/fTKUPehFF2A?si=oRlNNvSctK0vUUt4
Modifications: Changed the colors of the slither(snake) and grid. 
Added visual mechanics and features such as timer and additional blocks: scissors and power-up blocks.
Changed the interaction keys to WASD style.
----------------------------------------
*/

// Initializing global variables
let cols; let rows;
let size = 25;
let board = [];
let food; let head;
let pow; // power-up block
let sci; // scissors block
let dir;
let length = 1;
let gameOver = false;
let timer;

function setup() {
  createCanvas(900,600);
  frameRate(5);
  cols = 500 /size;
  rows = height /size;
  timer = millis();
  
  // Nested loop for the grid
  for (let i=0; i<cols; i++){
    board[i] = [];
    for (let j=0; j<rows; j++){
      board[i][j] = 0;
    }
  }
  
  // Initializing random spawning points
  food = createVector(int(random(0, cols)), int(random(0, rows)));
  pow = createVector(int(random(0, cols)), int(random(0, rows)));
  sci = createVector(int(random(0, cols)), int(random(0, rows)));
  head = createVector(int(random(0, cols)), int(random(0, rows)));
  dir = createVector(0,0);
}


function draw() {
  background(220);
  update();
  displayBoard();
  board[food.x][food.y] = -1;
  board[pow.x][pow.y] = -2
  board[sci.x][sci.y] = -3
  
  // Added texts for the mechanics and greeting message
  textAlign(LEFT);
  fill(0);
  textSize(30);
  textFont('Courier New');
  text("Welcome to Slither!", 530, 70);
  text("Mechanics:", 530, 110);
  text("Legend:", 530, 400)
  
  textSize(20);
  textWrap(WORD)
  text("* Use A,S,W,D to move your slither.",530,150, 400);
  text("* Collect food to grow your slither.",530, 205,400);
  text("* Avoid getting your tail cut by the scissors block!",530, 260,350);
  text("* Collect the power-up block to speed up!",530,315,350);
  text("* Win by surviving long!",530,370,350);
  text("Food = green block", 530, 440, 300);
  text("Power Up = yellow block", 530, 465, 300);
  text("Scissors = red block", 530, 490, 300);
  
  // Google Gemini(2026)
  // This section is generated by Gemini AI 
  // Prompt: "make me a survival timer for my slither game"
  // Modifications: Manually adjusted alignment of text and added noLoop() to stop the timer
  if (!gameOver) {
    // Calculate seconds: (Current time - Start time) / 1000
    let survivalTime = int((millis() - timer) / 1000);

    fill(255);
    textSize(20);
    textAlign(LEFT, TOP);
    text("Time Alive: " + survivalTime + "s", 10, 10);
  } else{
    // Game Over screen logic
    fill(255);
    text("YOU SURVIVED FOR " + int((millis() - timer) / 1000) + " SECONDS", 100, height/2);
    // End of AI-generated code
    noLoop();
  }
}

function update(){
  // Move Slither
  head.add(dir); 
  
  // Check if snake eats food: check if slither head and food are at the same location. Increment slither's length by 1 if yes. 
  if(dist(head.x, head.y, food.x, food.y) == 0){
    length += 1;
    generateFood();
  }

  // Added an if statement for when teh slither collides with the power-up block
  // When collided, the slither speeds up and generates another power-up and scissors block
  if(dist(head.x, head.y, pow.x, pow.y) == 0){
    let currentFPS = frameRate();
    frameRate(currentFPS + 2)
    
    generatePow();
    generateSci();
  }
  
  // Added an if statement for when the slither collides with the scissor block
  // When collided, the tail will cut off by 1 square and generates another scissors block
  if(dist(head.x, head.y, sci.x, sci.y) == 0){
    length -= 1
    
    generateSci();
  }
  
  // Added an if statement for when the length is equal to 0
  // Added for the scissor block feature
  if (length == 0){
    console.log("Game Over: Not enough length")
      gameOver = true
    }
  
  // Check if game is over, running into border or itself. If not, keep moving. 
  if (head.x < 0 || head.x > cols-1 || head.y < 0 || head.y > rows-1){
    console.log("Game Over: Run Into Border");
    gameOver = true;
  } else if (board[head.x][head.y] > 1) {
    console.log("Game Over: Run Into Itself");
    gameOver = true;
  	dir.set(0, 0);
  } else {
    board[head.x][head.y] = 1 + length; // Increment value of the head by one wherever the head moves to
    removeTail(); // Decrement by value of the board by one for the entire board
  }
  
}

function displayBoard(){
  for (let i=0; i<cols; i++){
    for (let j=0; j<rows; j++){
      if (board[i][j] == 0){
        fill(0); // Changed the board color to black
      } else if(board[i][j] == -1){
        fill(153, 204, 0); // Color for the food block
      } else if(board[i][j] == -2){
        fill(255, 204, 0); // Added a color to power-up block
      } else if(board[i][j] == -3){
        fill(255, 0, 0); // Added a color to scissors block 
      } else {
        fill(random(1,255), random(1,255), random(1,255),random(255));// Changed the colors to random for the slither 
      }
      rect(i*size, j*size, size, size);
      // displayText(i, j);
    }
  }
}


function generateFood(){
  while(true){
    food = createVector(int(random(0, cols-1)), int(random(0, rows-1)));
    if (board[food.x][food.y] == 0){
      break;
    }
  }
}

// Added a function for generating power-up block
function generatePow(){
  while(true){
    pow = createVector(int(random(0, cols-1)), int(random(0, rows-1)));
    if (board[pow.x][pow.y] == 0){
      break;
    }
  }
}

// Added a function for generating scissors block
function generateSci(){
  while(true){
    sci = createVector(int(random(0, cols-1)), int(random(0, rows-1)));
    if (board[sci.x][sci.y] == 0){
      break;
    }
  }
}

function removeTail(){
  for (let i=0; i<cols; i++){
    for (let j=0; j<rows; j++){
      if(board[i][j] > 0){
        board[i][j] -= 1;
      }
    }
  }
}

function displayText(x, y){
  textAlign(CENTER, CENTER);
  fill(255); // Changed the color to white for readability
  textSize(10);
  text(board[x][y], x*size+size/2, y*size+size/2);
}

// Changed the keys to ASWD style
function keyPressed(){
  if (keyCode === 65) {
    dir = createVector(-1, 0);
  } else if (keyCode === 68) {
    dir = createVector(1, 0);
  } else if (keyCode === 83) {
    dir = createVector(0, 1);
  } else if (keyCode === 87) {
    dir = createVector(0, -1);
  }
}
